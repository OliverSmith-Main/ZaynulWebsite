<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini E-Commerce Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #0f0f0f;
      --card-bg: #1a1a1a;
      --muted: #aaa;
      --accent: #0af;
      --danger: #e33;
    }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: #fff;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 16px;
      background: #161616;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .search-box {
      display: flex;
      gap: 6px;
      flex: 1;
      max-width: 480px;
    }
    input {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #222;
      color: #fff;
    }
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      font-weight: bold;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .cat-bar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .cat-btn {
      padding: 6px 12px;
      border-radius: 8px;
      background: #222;
      cursor: pointer;
      font-size: 14px;
      color: var(--muted);
    }
    .cat-btn.active {
      background: var(--accent);
      color: #fff;
    }
    #cartBtn {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
      cursor: pointer;
    }

    main {
      flex: 1;
      padding: 20px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }

    .card {
      perspective: 1000px;
      cursor: pointer;
    }
    .card-inner {
      position: relative;
      width: 100%;
      height: 320px;
      transform-style: preserve-3d;
      transition: transform 0.5s ease;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      padding: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .card-front img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
    }
    .card-front h3 {
      margin: 10px 0 6px;
      font-size: 1.1rem;
    }
    .meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: auto;
    }
    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .add-btn {
      background: var(--accent);
      color: #fff;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 14px;
      cursor: pointer;
    }
    .card-back {
      transform: rotateY(180deg);
      justify-content: center;
      font-size: 14px;
      line-height: 1.4;
      color: #ddd;
    }

    .empty-state {
      grid-column: 1/-1;
      padding: 28px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      text-align: center;
      color: var(--muted);
      font-size: 15px;
    }

    /* Lightbox Cart */
    .cart-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .cart-modal.active { display: flex; }
    .cart-content {
      background: #1a1a1a;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow: auto;
      padding: 20px;
      color: #fff;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .cart-items {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .cart-item {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #222;
      padding: 8px;
      border-radius: 8px;
    }
    .cart-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
    }
    .cart-item-info {
      flex: 1;
    }
    .cart-item-title { font-weight: bold; }
    .cart-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .cart-actions button { padding: 4px 8px; font-size: 14px; }
    .remove-btn { background: var(--danger); }
    .cart-footer {
      border-top: 1px solid #333;
      padding-top: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search products...">
      <button id="searchBtn">Search</button>
      <button id="clearBtn">Clear</button>
    </div>
    <div class="cat-bar">
      <div class="cat-btn active" data-cat="all">All</div>
      <div class="cat-btn" data-cat="electronics">Electronics</div>
      <div class="cat-btn" data-cat="home">Home</div>
      <div class="cat-btn" data-cat="fashion">Fashion</div>
    </div>
    <div id="cartBtn" role="button" tabindex="0">ðŸ›’ Cart (<span id="cartCount">0</span>)</div>
  </header>

  <main>
    <section id="grid"></section>
  </main>

  <!-- Cart Modal -->
  <div class="cart-modal" id="cartModal" aria-hidden="true" role="dialog" aria-label="Shopping cart">
    <div class="cart-content">
      <div class="cart-header">
        <h2>Your Cart</h2>
        <button id="closeCart">âœ–</button>
      </div>
      <div class="cart-items" id="cartItems"></div>
      <div class="cart-footer">
        <strong>Total:</strong> <span id="cartTotal">R0.00</span>
      </div>
    </div>
  </div>

  <script>
    const products = [
      {id:1,title:'Neo Headset',price:1299,cat:'electronics',img:'https://picsum.photos/seed/p1/800',description:'Wireless headset with deep bass, 30h battery, comfy memory-foam earcups and detachable mic.'},
      {id:2,title:'Lumen Lamp',price:459,cat:'home',img:'https://picsum.photos/seed/p2/800',description:'Minimal desk lamp with touch dimmer and warm-to-cool color temperatures. Perfect for night grinders.'},
      {id:3,title:'Grav Boots',price:899,cat:'fashion',img:'https://picsum.photos/seed/p3/800/800',description:'High-grip sneaks with rugged soles and a subtle reflective trim. Lightweight and comfy.'},
      {id:4,title:'Orbit Speaker',price:699,cat:'electronics',img:'https://picsum.photos/seed/p4/800',description:'Portable speaker with 360Â° sound and IPX5 splash resistance. Hits clean mids.'},
      {id:5,title:'Slip Hoodie',price:399,cat:'fashion',img:'https://picsum.photos/seed/p5/800',description:'Soft fleece hoodie, oversized fit, street-ready.'}
    ];

    const grid = document.getElementById('grid');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const clearBtn = document.getElementById('clearBtn');
    const cartBtn = document.getElementById('cartBtn');
    const cartCount = document.getElementById('cartCount');
    const cartModal = document.getElementById('cartModal');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const closeCart = document.getElementById('closeCart');

    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function saveCart() {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function money(n) {
      return new Intl.NumberFormat('en-ZA', { style:'currency', currency:'ZAR' }).format(n);
    }

    function updateCartDisplay() {
      cartCount.textContent = cart.reduce((a,c)=>a+c.qty,0);
      cartItems.innerHTML = '';
      if (!cart.length) {
        cartItems.innerHTML = '<p style="color:var(--muted)">Cart is empty</p>';
      } else {
        cart.forEach(item=>{
          const row = document.createElement('div');
          row.className = 'cart-item';
          row.innerHTML = `
            <img src="${item.img}" alt="${item.title}">
            <div class="cart-item-info">
              <div class="cart-item-title">${item.title}</div>
              <div>${money(item.price)} Ã— ${item.qty}</div>
            </div>
            <div class="cart-actions">
              <button class="remove-btn">X</button>
            </div>
          `;
          row.querySelector('.remove-btn').addEventListener('click',()=>{
            cart = cart.filter(p=>p.id!==item.id);
            saveCart();
            updateCartDisplay();
          });
          cartItems.appendChild(row);
        });
      }
      const total = cart.reduce((a,c)=>a+c.price*c.qty,0);
      cartTotal.textContent = money(total);
    }

    function addToCart(product) {
      const existing = cart.find(p=>p.id===product.id);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({...product, qty:1});
      }
      saveCart();
      updateCartDisplay();
    }

    // URL helpers
    function updateURL(q, cat) {
      const params = new URLSearchParams();
      if (q) params.set("q", q);
      if (cat && cat !== "all") params.set("cat", cat);
      const newUrl = window.location.pathname + (params.toString() ? "?" + params.toString() : "");
      history.replaceState(null, "", newUrl);
    }
    function readURL() {
      const params = new URLSearchParams(window.location.search);
      return { q: params.get("q") || "", cat: params.get("cat") || "all" };
    }

    function render(list) {
      grid.innerHTML = '';
      if (!list.length) {
        grid.innerHTML = '<div class="empty-state">No products found.<br><small>Try different search or clear filters.</small></div>';
        return;
      }
      list.forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        card.dataset.id = p.id;
        const inner = document.createElement('div');
        inner.className = 'card-inner';

        const front = document.createElement('div');
        front.className = 'card-front';
        front.innerHTML = `
          <img src="${p.img}" alt="${p.title}" loading="lazy" />
          <h3>${p.title}</h3>
          <div class="meta">${p.cat.toUpperCase()} â€¢ SKU-${p.id}</div>
          <div class="price-row">
            <div style="font-weight:800">${money(p.price)}</div>
            <button class="add-btn">+</button>
          </div>
        `;
        const back = document.createElement('div');
        back.className = 'card-back';
        back.innerHTML = `<div>${p.description}</div>`;

        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);
        grid.appendChild(card);

        card.addEventListener('click', e => {
          if (e.target.classList.contains('add-btn')) return;
          document.querySelectorAll('.card.flipped').forEach(c => { if (c!==card) c.classList.remove('flipped'); });
          card.classList.toggle('flipped');
        });

        card.tabIndex = 0;
        card.addEventListener('keydown', e => { if (e.key==='Enter'||e.key===' ') { e.preventDefault(); card.click(); } });

        front.querySelector('.add-btn').addEventListener('click', e => {
          e.stopPropagation();
          addToCart(p);
        });
      });
    }

    function filterAndRender() {
      const q = searchInput.value.trim().toLowerCase();
      const activeBtn = document.querySelector('.cat-btn.active');
      const cat = activeBtn ? activeBtn.dataset.cat : 'all';
      const filtered = products.filter(p => {
        const matchesCat = (cat==='all')||(p.cat===cat);
        const matchesQ = !q || p.title.toLowerCase().includes(q) || p.cat.toLowerCase().includes(q) || (`sku-${p.id}`).includes(q) || p.description.toLowerCase().includes(q);
        return matchesCat && matchesQ;
      });
      updateURL(q, cat);
      render(filtered);
    }

    // init
    const { q, cat } = readURL();
    searchInput.value = q;
    document.querySelectorAll('.cat-btn').forEach(btn=>{
      if (btn.dataset.cat===cat) {
        document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
      }
    });
    filterAndRender();
    updateCartDisplay();

    searchInput.addEventListener('input', filterAndRender);
    searchBtn.addEventListener('click', filterAndRender);
    clearBtn.addEventListener('click', ()=>{ searchInput.value=''; filterAndRender(); searchInput.focus(); });
    searchInput.addEventListener('keydown', e=>{ if (e.key==='Enter') filterAndRender(); });
    document.querySelectorAll('.cat-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{ document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); filterAndRender(); });
    });
    document.addEventListener('click', e=>{ if (!e.target.closest('.card')) document.querySelectorAll('.card.flipped').forEach(c=>c.classList.remove('flipped')); });
    window.addEventListener('resize', ()=>{ document.querySelectorAll('.card.flipped').forEach(c=>c.classList.remove('flipped')); });

    // cart modal handlers
    cartBtn.addEventListener('click', ()=>{ cartModal.classList.add('active'); cartModal.setAttribute('aria-hidden','false'); closeCart.focus(); });
    closeCart.addEventListener('click', ()=>{ cartModal.classList.remove('active'); cartModal.setAttribute('aria-hidden','true'); cartBtn.focus(); });
    window.addEventListener('keydown', e=>{ if (e.key==='Escape' && cartModal.classList.contains('active')) closeCart.click(); });
  </script>
</body>
</html>
